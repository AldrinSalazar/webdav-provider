version: "3"
services:
  hacdias-webdav:
    build: ./hacdias-webdav
    ports:
      - "8001:80"
    healthcheck:
      test: "curl -v --fail-with-body -u test:test -X PROPFIND http://127.0.0.1 || exit 1"
      interval: 1s
      timeout: 5s
  nginx-webdav:
    build: ./nginx
    ports:
      - "8002:80"
    environment:
      - NGINX_PORT=80
    healthcheck:
      test: "curl -v --fail-with-body -X PROPFIND http://127.0.0.1 || exit 1"
      interval: 1s
      timeout: 5s
  nextcloud-webdav:
    build: ./nextcloud
    ports:
      - "8003:80"
    environment:
      - NEXTCLOUD_ADMIN_USER=admin
      - NEXTCLOUD_ADMIN_PASSWORD=admin
    healthcheck:
      test: "curl -v -L --fail-with-body -u admin:admin -X PROPFIND http://127.0.0.1/remote.php/dav/files/admin"
      interval: 1s
      timeout: 5s
      retries: 30
  apache-webdav:
    build: ./apache
    ports:
      - "8004:80"
    healthcheck:
      test: "curl -v --fail-with-body -X PROPFIND -H 'Depth: 1' http://127.0.0.1 || exit 1"
      interval: 1s
      timeout: 5s
